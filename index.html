<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>WinCE Quiz Dashboard</title><style>:root{--xp-bg:#c0c0c0;--xp-dark:#808080;--xp-light:#f0f0f0;--xp-blue:#0a246a;--xp-accent:#0078d7;--xp-border:#404040;--xp-text:#000000;--danger:#b00020}*{box-sizing:border-box;font-family:"Tahoma","Segoe UI",sans-serif}body{margin:0;background:radial-gradient(circle at top left,#e0e0e0,#a0a0a0);color:var(--xp-text)}.app-shell{max-width:960px;margin:20px auto;border:2px solid var(--xp-border);background:var(--xp-bg);box-shadow:0 0 0 1px #fff inset,0 0 12px rgba(0,0,0,.4)}.title-bar{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(to right,#0a246a,#3a6ea5);color:#fff;padding:4px 8px;font-size:12px}.title-left{display:flex;align-items:center;gap:6px}.logo-box{width:18px;height:18px;background:linear-gradient(135deg,#0ff,#f0f);border-radius:3px;border:1px solid #fff}.title-text{font-weight:bold}.title-right{display:flex;align-items:center;gap:8px;font-size:11px}.user-logo{width:20px;height:20px;border-radius:3px;border:1px solid #fff;background-size:cover;background-position:center;background-color:#444}.hamburger{display:none;width:20px;height:16px;flex-direction:column;justify-content:space-between;cursor:pointer}.hamburger span{display:block;height:3px;background:#fff;border-radius:2px}.window-body{padding:10px;background:linear-gradient(to bottom,#f4f4f4,#c0c0c0)}.top-status-bar{display:flex;justify-content:space-between;align-items:center;background:#d4d4d4;border:1px solid #fff;box-shadow:0 0 0 1px #808080 inset;padding:4px 8px;font-size:11px;margin-bottom:8px}.status-group{display:flex;align-items:center;gap:10px}.status-label{font-weight:bold}.pill{padding:2px 6px;border-radius:10px;border:1px solid #808080;background:#f8f8f8;min-width:60px;text-align:center}.pill-balance{background:linear-gradient(to bottom,#e8ffe8,#b0e0b0)}.pill-reversal{background:linear-gradient(to bottom,#ffe8e8,#e0b0b0)}.pill-logged{background:linear-gradient(to bottom,#e8f0ff,#b0c4e0)}.content-grid{display:grid;grid-template-columns:260px 1fr;gap:10px}.panel{border:1px solid #fff;box-shadow:0 0 0 1px #808080 inset;background:#dcdcdc;padding:8px;font-size:12px}.panel-title{font-weight:bold;margin-bottom:6px;padding-bottom:3px;border-bottom:1px solid #b0b0b0}.field-group{margin-bottom:6px}.field-label{display:block;font-size:11px;margin-bottom:2px}input[type="text"],input[type="password"]{width:100%;padding:3px 4px;border:1px solid #808080;background:#fff;font-size:12px}button{padding:3px 10px;font-size:12px;border:1px solid #404040;background:linear-gradient(to bottom,#f8f8f8,#c0c0c0);cursor:pointer}button:active{background:linear-gradient(to bottom,#c0c0c0,#f8f8f8)}button[disabled]{opacity:.5;cursor:default}.btn-primary{background:linear-gradient(to bottom,#fff,#d0e4ff);border-color:#0a246a}.btn-danger{background:linear-gradient(to bottom,#ffe0e0,#ffb0b0);border-color:#800000}.mini-note{font-size:10px;color:#333}.quiz-questions{margin-top:6px}.quiz-question{margin-bottom:6px;padding:4px;border-radius:3px;background:#f4f4f4;border:1px solid #b0b0b0}.quiz-question span{font-weight:bold}.quiz-input{margin-top:3px}.info-line{font-size:11px;margin-top:4px}.reward-info-box{margin-top:6px;padding:4px;border-radius:3px;background:#fffbe8;border:1px solid #c0a000;font-size:11px}.footer-bar{margin-top:8px;font-size:10px;text-align:right;color:#333}.hidden{display:none!important}.toast{position:fixed;bottom:12px;left:12px;background:var(--danger);color:#fff;padding:8px 12px;border-radius:4px;font-size:11px;box-shadow:0 2px 6px rgba(0,0,0,.4);opacity:0;pointer-events:none;transform:translateY(10px);transition:opacity .2s ease,transform .2s ease;z-index:9999}.toast.show{opacity:1;pointer-events:auto;transform:translateY(0)}@media (max-width:720px){.app-shell{margin:5px}.content-grid{grid-template-columns:1fr}.hamburger{display:flex}.left-panel-collapsed .left-panel{display:none}.toast{left:50%;transform:translate(-50%,10px)}.toast.show{transform:translate(-50%,0)}}</style></head><body><div class="app-shell" id="appShell"><div class="title-bar"><div class="title-left"><div class="logo-box"></div><div class="title-text">Quiz Rewards Console</div></div><div class="title-right"><div id="titleUser" class="mini-user">Guest</div><div id="titleUserLogo" class="user-logo"></div><div class="hamburger" id="hamburger"><span></span><span></span><span></span></div></div></div><div class="window-body"><div class="top-status-bar"><div class="status-group"><span class="status-label">Session:</span><span id="loginStatus" class="pill pill-logged">Logged out</span><button id="logoutBtn" class="btn-danger" style="display:none">Logout</button></div><div class="status-group"><span class="status-label">Balance:</span><span id="balancePill" class="pill pill-balance">0.0 pts</span><span class="status-label">Reversal:</span><span id="reversalPill" class="pill pill-reversal">0.0 %</span></div></div><div class="content-grid"><div class="panel left-panel"><div class="panel-title">Logo | LOGIN | Quiz Access</div><div id="loginPanel"><div class="field-group"><label class="field-label" for="userIdInput">UserID</label><input type="text" id="userIdInput" placeholder="matvei"></div><div class="field-group"><label class="field-label" for="passIdInput">PassID</label><input type="password" id="passIdInput" placeholder="matvei"></div><button id="loginBtn" class="btn-primary">Login</button><div class="mini-note">Enter your UserID and PassID from the sheet</div></div><div id="quizIdPanel" class="hidden"><div class="field-group" style="margin-top:8px"><label class="field-label" for="quizIdInput">Quiz Access ID</label><input type="text" id="quizIdInput" placeholder="matvei01"></div><button id="loadQuizBtn" class="btn-primary">Load Quiz</button><div class="mini-note">Enter Quiz Access ID to load your quiz</div></div></div><div class="panel"><div class="panel-title">Mini Dashboard | Quiz | Reward</div><div id="quizPanel" class="hidden"><div id="quizMeta" class="info-line"></div><div class="quiz-questions" id="quizQuestions"></div><button id="submitQuizBtn" class="btn-primary" disabled>Submit Answers</button><div id="quizResult" class="info-line"></div></div><div id="rewardPanel" class="hidden"><div class="info-line"><strong>Reward:</strong> <span id="rewardNameLabel"></span> | <strong>Reward Amount:</strong> <span id="rewardAmountLabel"></span></div><button id="redeemBtn" class="btn-primary">Redeem Reward</button><div id="rewardInfoBox" class="reward-info-box hidden"></div></div></div></div><div class="footer-bar">Reversal % = (1 − (Earned / Total)) × 100 &nbsp;|&nbsp; 1/3 of 250 = 83.3 pts</div></div></div><div id="toast" class="toast"></div><script>const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vR8c9rGFe2qunf8205Gu59lTiysorK2s1hJbLtnBZ1VRh-84UM4iNSmR1_fI8S1dgKhZTDLEvhYkNxK/pub?gid=0&single=true&output=csv";const WEB_APP_URL="https://script.google.com/macros/s/AKfycbysBPnER1qFVMWyv1rBqHCzI1j5B9PS0jZ3SMX3JbAGK2iz9q0sSNvlmsLIRF8MfZ-B/exec";let currentUser=null,currentRow=null,currentBalance=0,currentReversal=0,earnedThisQuiz=0,currentQuizId=null;const appShell=document.getElementById("appShell"),hamburger=document.getElementById("hamburger"),loginPanel=document.getElementById("loginPanel"),quizIdPanel=document.getElementById("quizIdPanel"),quizPanel=document.getElementById("quizPanel"),rewardPanel=document.getElementById("rewardPanel"),loginBtn=document.getElementById("loginBtn"),logoutBtn=document.getElementById("logoutBtn"),loadQuizBtn=document.getElementById("loadQuizBtn"),submitQuizBtn=document.getElementById("submitQuizBtn"),redeemBtn=document.getElementById("redeemBtn"),loginStatus=document.getElementById("loginStatus"),balancePill=document.getElementById("balancePill"),reversalPill=document.getElementById("reversalPill"),titleUser=document.getElementById("titleUser"),titleUserLogo=document.getElementById("titleUserLogo"),quizMeta=document.getElementById("quizMeta"),quizQuestions=document.getElementById("quizQuestions"),quizResult=document.getElementById("quizResult"),rewardNameLabel=document.getElementById("rewardNameLabel"),rewardAmountLabel=document.getElementById("rewardAmountLabel"),rewardInfoBox=document.getElementById("rewardInfoBox"),toastEl=document.getElementById("toast");function showToast(m){toastEl.textContent=m,toastEl.classList.add("show"),setTimeout(()=>{toastEl.classList.remove("show")},2500)}function setLoggedIn(u,l){currentUser=u,loginStatus.textContent="Logged in",loginStatus.classList.add("pill-logged"),titleUser.textContent=u,l&&l!="#"?(titleUserLogo.style.backgroundImage=`url('${l}')`,titleUserLogo.style.backgroundColor=""):(titleUserLogo.style.backgroundImage="none",titleUserLogo.style.backgroundColor="#444"),loginPanel.classList.add("hidden"),quizIdPanel.classList.remove("hidden"),logoutBtn.style.display="inline-block"}function setLoggedOut(){currentUser=null,currentRow=null,currentQuizId=null,currentBalance=0,currentReversal=0,earnedThisQuiz=0,loginStatus.textContent="Logged out",titleUser.textContent="Guest",titleUserLogo.style.backgroundImage="none",titleUserLogo.style.backgroundColor="#444",balancePill.textContent="0.0 pts",reversalPill.textContent="0.0 %",loginPanel.classList.remove("hidden"),quizIdPanel.classList.add("hidden"),quizPanel.classList.add("hidden"),rewardPanel.classList.add("hidden"),logoutBtn.style.display="none",quizQuestions.innerHTML="",quizResult.textContent="",rewardInfoBox.classList.add("hidden"),rewardInfoBox.textContent="",document.getElementById("userIdInput").value="",document.getElementById("passIdInput").value="",document.getElementById("quizIdInput").value=""}function updateBalanceUI(e,t){currentBalance+=e;const r=t>0?(1-e/t)*100:0;currentReversal=r,balancePill.textContent=currentBalance.toFixed(1)+" pts",reversalPill.textContent=r.toFixed(1)+" %"}function parseCSV(t){const e=t.trim().split(/\r?\n/).map(t=>t.split(",").map(t=>t.replace(/^"|"$/g,"")));return{header:e[0],data:e.slice(1)}}async function fetchSheet(){const t=await fetch(CSV_URL),e=await t.text();return parseCSV(e)}function findRowByUserAndPass(t,e,n){const r=t.header,o=t.data,s=r.indexOf("UserID"),i=r.indexOf("PassID");if(s===-1||i===-1)return null;for(const t of o)if(t[s]===e&&t[i]===n)return{header:r,row:t};return null}function findRowByQuizId(t,e){const n=t.header,r=t.data,o=n.indexOf("Quiz Access ID");if(o===-1)return null;for(const t of r)if(t[o]===e)return{header:n,row:t};return null}function getHeaderIndex(t,e){for(const n of e){const e=t.indexOf(n);if(e!==-1)return e}return-1}function buildQuizUI(h,r){quizQuestions.innerHTML="",quizResult.textContent="",submitQuizBtn.disabled=!1,currentQuizId=document.getElementById("quizIdInput").value.trim();const o=getHeaderIndex(h,["Q1"]),s=getHeaderIndex(h,["Q2"]),i=getHeaderIndex(h,["Q3"]),l=getHeaderIndex(h,["A1"]),c=getHeaderIndex(h,["A2"]),a=getHeaderIndex(h,["A3"]),d=h.indexOf("Reward Amount"),u=getHeaderIndex(h,["Reversal","Reversal Balance"]),g=getHeaderIndex(h,["Balance"]),p=getHeaderIndex(h,["RewardName"]),m=h.indexOf("RewardAmount"),y=getHeaderIndex(h,["RewardINFO"]),b=h.indexOf("UserLogo");currentRow={q1:r[o],q2:r[s],q3:r[i],a1:r[l],a2:r[c],a3:r[a],rewardAmount:parseFloat(r[d]||"0"),rewardName:r[p]||"",rewardAmount2:parseFloat(r[m]||"0"),rewardInfo:r[y]||"",userLogo:r[b]||""},currentBalance=isNaN(parseFloat(r[g]||"0"))?0:parseFloat(r[g]||"0"),currentReversal=isNaN(parseFloat(r[u]||"0"))?0:parseFloat(r[u]||"0"),balancePill.textContent=currentBalance.toFixed(1)+" pts",reversalPill.textContent=currentReversal.toFixed(1)+" %",currentRow.userLogo&&currentRow.userLogo!=="#"&&(titleUserLogo.style.backgroundImage=`url('${currentRow.userLogo}')`,titleUserLogo.style.backgroundColor=""),quizMeta.textContent=`Reward: ${currentRow.rewardName} | Total Reward Amount: ${currentRow.rewardAmount}`;const v=[{label:"Q1",text:r[o],id:"userQ1"},{label:"Q2",text:r[s],id:"userQ2"},{label:"Q3",text:r[i],id:"userQ3"}];v.forEach(t=>{const e=document.createElement("div");e.className="quiz-question",e.innerHTML=`<div><span>${t.label}:</span> ${t.text}</div><div class="quiz-input"><input type="text" id="${t.id}" placeholder="Your answer"></div>`,quizQuestions.appendChild(e)}),rewardNameLabel.textContent=currentRow.rewardName,rewardAmountLabel.textContent=(currentRow.rewardAmount2||0).toFixed(1)+" pts",rewardInfoBox.textContent=currentRow.rewardInfo,rewardInfoBox.classList.add("hidden")}function gradeQuiz(){if(!currentRow)return;const t=document.getElementById("userQ1").value.trim(),e=document.getElementById("userQ2").value.trim(),n=document.getElementById("userQ3").value.trim();let r=0;t===String(currentRow.a1)&&r++,e===String(currentRow.a2)&&r++,n===String(currentRow.a3)&&r++;const o=3,s=currentRow.rewardAmount||0,a=s/o,c=a*r;earnedThisQuiz=c,updateBalanceUI(c,s),quizResult.textContent=`Correct: ${r}/${o} | Earned: ${c.toFixed(1)} pts | Total Reward: ${s.toFixed(1)} pts`,submitQuizBtn.disabled=!0}async function updateSheet(userId,quizId,earned,total){try{const response=await fetch(WEB_APP_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:userId,quizId:quizId,earned:earned,total:total})});const result=await response.json();if(result.success){showToast("Balance and Reversal updated in sheet!");return!0}else{showToast("Update failed: "+result.message);return!1}}catch(error){console.warn("Update error:",error),showToast("Update failed - check console");return!1}}function canRedeem(){return currentRow&&currentBalance>=(currentRow.rewardAmount2||0)}function handleRedeem(){canRedeem()?rewardInfoBox.classList.remove("hidden"):showToast("Minimum points not reached to redeem this reward.")}async function handleQuizSubmission(){if(!currentRow||!currentUser||!currentQuizId)return;gradeQuiz();const quizIdInput=document.getElementById("quizIdInput"),success=await updateSheet(currentUser,currentQuizId,earnedThisQuiz,currentRow.rewardAmount);if(success){quizIdInput.value="",quizPanel.classList.add("hidden"),rewardPanel.classList.add("hidden"),quizQuestions.innerHTML="",quizResult.textContent="",showToast("Quiz completed! Enter a new Quiz Access ID to load another quiz.")}else{showToast("Failed to update sheet. Please try again.")}}loginBtn.addEventListener("click",async()=>{const t=document.getElementById("userIdInput").value.trim(),e=document.getElementById("passIdInput").value.trim();if(!t||!e)return void showToast("Enter UserID and PassID.");try{const n=await fetchSheet(),r=findRowByUserAndPass(n,t,e);r?(setLoggedIn(t,r.row[r.header.indexOf("UserLogo")]),showToast(`Welcome ${t}!`)):showToast("UserID / PassID not found.")}catch(t){console.error(t),showToast("Error loading sheet.")}}),logoutBtn.addEventListener("click",()=>{setLoggedOut(),showToast("Logged out")}),loadQuizBtn.addEventListener("click",async()=>{const t=document.getElementById("quizIdInput").value.trim();if(!t)return void showToast("Enter Quiz Access ID.");try{const e=await fetchSheet(),n=findRowByQuizId(e,t);n?(buildQuizUI(n.header,n.row),quizPanel.classList.remove("hidden"),rewardPanel.classList.remove("hidden"),showToast("Quiz loaded!")):showToast("Quiz Access ID not found.")}catch(t){console.error(t),showToast("Error loading quiz from sheet.")}}),submitQuizBtn.addEventListener("click",()=>{handleQuizSubmission()}),redeemBtn.addEventListener("click",()=>{handleRedeem()}),hamburger.addEventListener("click",()=>{appShell.classList.toggle("left-panel-collapsed")}),setLoggedOut();</script></body></html>
