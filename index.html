<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>IML Terminal</title>

<style>
html,body{
  margin:0;height:100%;
  background:#1a1a1a;
  font-family:Tahoma;
  color:#fff;
}
#device{
  width:480px;height:800px;
  margin:auto;
  background:linear-gradient(#3c3c3c,#0f0f0f);
  border:3px solid #777;
}
#header{
  height:70px;
  background:linear-gradient(#666,#222);
  display:flex;
  align-items:center;
  padding:10px;
}
#icon{
  width:40px;height:40px;
  background:linear-gradient(#0ff,#046);
  border-radius:6px;
  margin-right:10px;
}
#title{font-size:28px;font-weight:bold;}
#content{padding:20px;}
input,button{
  width:100%;
  padding:10px;
  font-size:18px;
  margin-top:10px;
}
input{
  background:#000;color:#0f0;
  border:2px inset #555;
}
button{
  background:linear-gradient(#4caf50,#2e7d32);
  border:none;color:#fff;
}
.panel{
  margin-top:15px;
  padding:10px;
  background:#000;
  border:2px inset #555;
}
.hidden{display:none;}
</style>
</head>

<body>

<div id="device">
  <div id="header">
    <div id="icon"></div>
    <div id="title">IML</div>
  </div>

  <div id="content">

    <div id="loginBox">
      <input id="uid" placeholder="UserID">
      <input id="pid" placeholder="PassID" type="password">
      <button onclick="login()">LOGIN</button>
    </div>

    <div id="infoBox" class="panel hidden">
      Status: <span id="status"></span><br>
      PTS: <span id="pts"></span><br>
      Reversal Rate: <span id="rate">0%</span>
    </div>

    <div id="quizBox" class="panel hidden">
      <div id="question"></div>
      <input id="answer" placeholder="Your answer">
      <button onclick="submitQuiz()">SUBMIT</button>
    </div>

  </div>
</div>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/1ACxwDbnT2mpbwmIzTy_Df8Ev48wHCODFs-rukSVeBro/export?format=csv";

let currentUser = null;
let correctAnswer = "";
let reversalRate = 0;

async function login(){
  const u = uid.value.trim();
  const p = pid.value.trim();

  const res = await fetch(CSV_URL);
  const text = await res.text();

  const rows = text
    .trim()
    .split(/\r?\n/)
    .map(r => r.split(",").map(v => v.replace(/^"|"$/g,"").trim()));

  rows.shift(); // remove header

  currentUser = rows.find(r => r[0]===u && r[1]===p);

  if(!currentUser){
    alert("LOGIN FAILED");
    return;
  }

  status.textContent = currentUser[2];
  pts.textContent = currentUser[3];
  rate.textContent = "0%";

  question.textContent = currentUser[5];
  correctAnswer = currentUser[6];

  loginBox.classList.add("hidden");
  infoBox.classList.remove("hidden");
  quizBox.classList.remove("hidden");
}

function submitQuiz(){
  const a = answer.value.trim();
  if(a !== correctAnswer){
    reversalRate++;
    rate.textContent = reversalRate + "%";
  }

  // clear quiz for this user (session)
  currentUser[5] = "";
  currentUser[6] = "";
  currentUser[7] = "";

  question.textContent = "No active quiz";
  quizBox.classList.add("hidden");

  alert("Quiz completed");
}
</script>

</body>
</html>
